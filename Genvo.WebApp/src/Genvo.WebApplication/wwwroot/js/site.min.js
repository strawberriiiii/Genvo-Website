function addExampleData(){$.when(loadExampleHostTree(),loadExampleGuestTree()).done(function(n,t){hostTreeFile=ParseTreeData(n[0]);guestTreeFile=ParseTreeData(t[0]);document.getElementById("dz-host-text").innerHTML="<strong>Example data loaded<\/strong>";document.getElementById("dz-guest-text").innerHTML="<strong>Example data loaded<\/strong>";$("#senddatatoviz").removeClass("disabled");$("input[name=twoFileLabelOption]:checked").parent().removeClass("active");const i=$("input[name=twoFileLabelOption]:radio[value=postfix]");i.prop("checked",!0);i.parent().addClass("active");console.log("successfully fetched example data")})}function loadExampleHostTree(){return $.ajax({url:"./data/ExampleHostTree1",type:"POST"})}function loadExampleGuestTree(){return $.ajax({url:"./data/ExampleGuestTree1",type:"POST"})}function DataParser(n){this.data=this.ParseNewickToJSON(n)}function ParseTreeData(n,t){const i=new DataParser(n,t);return i.data}function parseNhxLabel(n,t,i){switch(i){case":D=":n.nhx.event=t==="Y"?"dup":"spec";break;case"S=":n.nhx.species=t;break;case"NAME=":n.nhx.name=t}}function parsePrimeLabel(n,t,i){switch(i){case"S=":n.prime.species=t;break;case"NAME=":n.prime.name=t;break;case"ID=":n.prime.id=t}}function handleHostFile(n){n.stopPropagation();n.preventDefault();var t=getDropedFile(n);document.getElementById("dz-host-text").innerHTML=`<strong>${escape(t.name)}</strong>`;readSelectedFile(t,"host")}function handleGuestFile(n){n.stopPropagation();n.preventDefault();var t=getDropedFile(n);document.getElementById("dz-guest-text").innerHTML=`<strong>${escape(t.name)}</strong>`;readSelectedFile(t,"guest")}function handleReconFile(n){n.stopPropagation();n.preventDefault();var t=getDropedFile(n);document.getElementById("dz-recon-text").innerHTML=`<strong>${escape(t.name)}</strong>`;readSelectedFile(t,"reconciled")}function getDropedFile(n){var t=n.dataTransfer.files;return t[0]}function readSelectedFile(n,t){var i=new FileReader;i.onload=function(n){if(n.target.readyState===2){if(n.target.error){alert("Error while reading file");return}switch(t){case"host":hostTreeFile=ParseTreeData(n.target.result);break;case"guest":guestTreeFile=ParseTreeData(n.target.result);break;case"reconciled":reconciledTreeFile=ParseTreeData(n.target.result);break;default:alert("error 1: drop zone ID error")}reconciledTreeFile!==undefined&&$("#btnvisualizereconciled").removeClass("disabled");guestTreeFile!==undefined&&hostTreeFile!==undefined&&$("#senddatatoviz").removeClass("disabled")}};i.readAsText(n)}function handleDragOver(n){n.stopPropagation();n.preventDefault();n.dataTransfer.dropEffect="copy"}function senddata(n){var t;if(n.target.id==="btnvisualizereconciled"){if(reconciledTreeFile===undefined){window.alert("Host and / or guest tree not uploaded");return}const n=$("input[name=reconciledFileFormatOption]:checked").val();getReconciledSpeciesTree(n);t={isReconciled:!0,LabelFormat:n,ReconTree:reconciledTreeFile,ReconSpeciesTree:reconciledHostTreeFile}}else{if(guestTreeFile===undefined||hostTreeFile===undefined){window.alert("Host and / or guest tree not uploaded");return}t={isReconciled:!1,LabelFormat:$("input[name=twoFileLabelOption]:checked").val(),GeneTree:guestTreeFile,SpeciesTree:hostTreeFile}}packdatalocal(t,"_GSTree");window.location.href="visualization"}function getReconciledSpeciesTree(n){switch(n){case"nhx":reconciledHostTreeFile=ParseTreeData(reconciledTreeFile.tag.notung.speciesTree)}}function packdatalocal(n,t){n=JSON.stringify(n);n=btoa(n);localStorage.setItem(t,n)}var dropZoneHost,dropZoneGuest,dropZoneRecon,sendbutton,sendReconBtn,exampledatabutton;DataParser.prototype.ParseNewickToJSON=function(n){var r=[],t={tag:{common:"",nhx:{},prime:{},notung:{}}},u=!1,f="",i;const e=n.split(/\s*(;|\(|\)|,|:|\[|\])\s*/);for(let n=0;n<e.length;n++){const o=e[n],s={};if(u&&o!=="]"){f+=o;continue}switch(o){case"(":t.children=[s];r.push(t);t=s;t.tag={};break;case",":r[r.length-1].children.push(s);t=s;t.tag={};break;case")":t=r.pop();break;case":":break;case"[":u=!0;break;case"]":t.tag=this.parseTreeTag(f,t.tag);u=!1;f="";break;default:i=e[n-1];i===")"||i==="("||i===","?t.name=o:i===":"&&(t.length=parseFloat(o))}}return console.log(t),t};DataParser.prototype.parseTreeTag=function(n,t){const r=n.split(/\s*(\${2}NHX|\&{2}NHX|\&{2}PRIME|\&{2}NOTUNG-SPECIES-TREE|\&{2}NOTUNG-PARAMETERS|S=|ID=|NAME=|:D=|:)\s*/);var u,f=!1;const i={notung:t.notung!==undefined?t.notung:{},prime:t.prime!==undefined?t.prime:{},nhx:t.nhx!==undefined?t.nhx:{},common:t.common!==undefined?t.common:""};for(let n=0;n<r.length;n++){const t=r[n];switch(t){case"&&NOTUNG-PARAMETERS":case"&&NOTUNG-SPECIES-TREE":u="notung";f=!0;continue;case"&&NHX":case"$$NHX":u="nhx";continue;case"&&PRIME":u="prime";continue}const e=r[n-1];switch(u){case"prime":parsePrimeLabel(i,t,e);break;case"nhx":parseNhxLabel(i,t,e);break;case"notung":this.parseNotung(i,r,e);break;default:i.common+=t}if(f)break}return i};DataParser.prototype.parseNotung=function(n,t,i){switch(i){case"&&NOTUNG-SPECIES-TREE":n.notung.speciesTree=t.slice(2).join("");break;case"&&NOTUNG-PARAMETERS":n.notung.parameters=t.slice(2).join("")}};window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser. Use the latest Chrome browser");let guestTreeFile,hostTreeFile,reconciledTreeFile,reconciledHostTreeFile;dropZoneHost=document.getElementById("drop_zone_host");dropZoneHost.addEventListener("dragover",handleDragOver,!1);dropZoneHost.addEventListener("drop",handleHostFile,!1);dropZoneHost.addEventListener("click",handleDragOver,!1);dropZoneGuest=document.getElementById("drop_zone_guest");dropZoneGuest.addEventListener("dragover",handleDragOver,!1);dropZoneGuest.addEventListener("drop",handleGuestFile,!1);dropZoneRecon=document.getElementById("drop_zone_reconciledfileformat");dropZoneRecon.addEventListener("dragover",handleDragOver,!1);dropZoneRecon.addEventListener("drop",handleReconFile,!1);sendbutton=document.getElementById("senddatatoviz");sendbutton.addEventListener("click",senddata,!1);sendReconBtn=document.getElementById("btnvisualizereconciled");sendReconBtn.addEventListener("click",senddata,!1);exampledatabutton=document.getElementById("button_exampledata");exampledatabutton.addEventListener("click",addExampleData,!1);